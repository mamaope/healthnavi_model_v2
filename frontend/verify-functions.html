<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Functions - HealthNavi</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1e1e1e;
            color: #00ff00;
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #004400; border: 2px solid #00ff00; }
        .error { background: #440000; border: 2px solid #ff0000; color: #ff0000; }
        .info { background: #004466; border: 2px solid #0099ff; color: #0099ff; }
        pre { background: #000; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .btn {
            background: #00ff00;
            color: #000;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        .btn:hover { background: #00cc00; }
    </style>
</head>
<body>
    <h1>üîç Function Verification Tool</h1>
    <p>This page checks if script.js functions are loaded correctly.</p>
    
    <div id="results"></div>
    
    <h2>Actions:</h2>
    <button class="btn" onclick="location.reload()">üîÑ Reload Page</button>
    <button class="btn" onclick="clearCacheAndReload()">üóëÔ∏è Clear & Reload</button>
    <button class="btn" onclick="window.open('index.html', '_blank')">‚Üí Go to App</button>
    
    <h2>Manual Cache Clear:</h2>
    <pre>1. Press Ctrl+Shift+Delete
2. Select "Cached images and files"
3. Select "All time"
4. Click "Clear data"
5. Close all browser tabs
6. Open a new window and try again</pre>

    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"></script>
    <script src="script.js?nocache=<?php echo time(); ?>"></script>
    
    <script>
        const results = document.getElementById('results');
        
        function addStatus(type, message) {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        function checkFunction(name) {
            const exists = typeof window[name] !== 'undefined';
            if (exists) {
                addStatus('success', `‚úÖ ${name} - FOUND`);
            } else {
                addStatus('error', `‚ùå ${name} - MISSING`);
            }
            return exists;
        }
        
        function clearCacheAndReload() {
            // Clear service workers
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    registrations.forEach(reg => reg.unregister());
                });
            }
            
            // Clear localStorage
            localStorage.clear();
            sessionStorage.clear();
            
            // Reload with cache bust
            location.href = location.href.split('?')[0] + '?nocache=' + Date.now();
        }
        
        // Wait for script to load
        setTimeout(() => {
            addStatus('info', 'üìã Checking critical functions...');
            
            const functions = [
                'showAuthModal',
                'useSamplePrompt',
                'handleSubmit',
                'addMessage',
                'formatAIResponse',
                'renderMarkdownWithEnhancements',
                'fixMarkdownSpacing'
            ];
            
            let allFound = true;
            functions.forEach(fn => {
                const found = checkFunction(fn);
                if (!found) allFound = false;
            });
            
            if (allFound) {
                addStatus('success', 'üéâ ALL FUNCTIONS LOADED! Cache is clear.');
                addStatus('info', '‚úÖ You can now use the app normally. Click "Go to App" above.');
            } else {
                addStatus('error', '‚ö†Ô∏è SOME FUNCTIONS MISSING! Cache still needs clearing.');
                addStatus('info', 'üí° Try: Close ALL browser windows, open a NEW window, then Ctrl+Shift+R');
            }
            
            // File size check
            addStatus('info', `üì¶ Script.js should be ~70-80 KB. Check Network tab in DevTools.`);
            
        }, 500);
    </script>
</body>
</html>

